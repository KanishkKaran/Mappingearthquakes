<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Earthquake Tremors in New Delhi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet">
    <style>
        /* Smooth scrolling and performance optimizations */
        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* GPU acceleration for smooth animations */
        .step, .sticky, img {
            transform: translateZ(0);
            will-change: transform, opacity;
        }

        svg {
            display: block;
            margin: 0 auto;
        }

        img.block {
            display: block;
            border: solid #333 1px;
            margin: 0 auto;
        }

        svg {
            margin-bottom: 15px;
        }

        .step {
            padding-bottom: 120px;
            margin-bottom: 20px;
            margin-left: auto;
            opacity: 0.3;
            transition: opacity 0.5s ease-in-out;
        }

        .step, .row {
            padding-top: 2rem;
        }

        .step:last-of-type {
            padding-bottom: 300px;
        }

        .step.active {
            opacity: 1;
            background: rgba(250, 208, 196, 0.2);
            padding: 20px;
            border-radius: 8px;
            transform: translateX(0);
            transition: all 0.5s ease-in-out;
        }

        h1 {
            font-family: 'EB Garamond', serif;
            font-weight: 400;
        }

        h3 {
            font-family: 'EB Garamond', serif;
            font-weight: 400;
        }

        p {
            font-family: 'EB Garamond', serif;
            font-weight: 100;
            line-height: 1.6;
        }

        mark {
            background: #FAD0C4;
            color: black;
            font-family: 'EB Garamond', serif;
            padding: 2px 4px;
            border-radius: 3px;
        }

        footer {
            background: #f1f1f1;
            color: #333;
            padding: 60px 0;
            text-align: center;
        }

        .bg1 {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('backgrounds/Background-main.jpg');
            background-size: cover;
            background-position: center;
            min-height: 100vh;
        }

        .bg2 {
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('backgrounds/Background-main1.jpg');
            background-size: cover;
            background-position: center;
            min-height: 50vh;
        }

        .background-image {
            background-size: cover;
            padding: 150px 50px;
            color: white;
            text-align: center;
            text-shadow: 0 0 5px rgba(0,0,0,0.5),
                         0 0 15px rgba(0,0,0,0.5),
                         0 0 25px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .background-image h1 {
            text-transform: uppercase;
            font-size: 3rem;
            margin: 0;
        }

        .background-image h3 {
            font-size: 1.5rem;
            margin-top: 1rem;
        }

        .graphic {
            padding-bottom: 30px;
        }

        .sticky {
            position: -webkit-sticky;
            position: sticky;
            height: fit-content;
            top: 20%;
            z-index: 1;
        }

        img {
            max-width: 100%;
            height: auto;
            transition: all 0.6s ease-in-out;
        }

        #globe {
            max-width: 75%;
            mix-blend-mode: normal;
            transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
        }

        #mountains {
            transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
        }

        .center-image {
            margin: 0 auto;
            display: block;
            padding: 15px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .main-title {
            margin: 5% 2% 2% 2%;
            padding: 2rem 0;
            background: rgba(255, 255, 255, 0.95);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .background-image h1 {
                font-size: 2rem;
            }
            
            .sticky {
                position: relative;
                top: auto;
            }
            
            .step {
                padding-bottom: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="background-image bg1">
        <div>
            <h1>Earthquake Alert</h1>
            <h3>Tremors felt across New Delhi region</h3>
        </div>
    </div>

    <!-- Main Title -->
    <div class="main-title">
        <div class="container">
            <h1 class="text-center">Tremors felt in New Delhi after Afghanistan quakes</h1>
        </div>
    </div>

    <!-- First Scrollytelling Section -->
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="step" id="step-one">
                    <p>India just witnessed earthquake tremors. If you look carefully at the globe, you'll notice the seismic activity spreading across the region.</p>
                </div>
                <div class="step" id="step-two">
                    <p>The earthquake shook buildings in Afghan capital Kabul, but there were no immediate reports of damage or casualties, reported Reuters. People in Delhi and the NCR region reported feeling light earthquake tremors.</p>
                    <p>The quake was felt at about 4:15 pm today in the states of Punjab, Haryana and Jammu and Kashmir, a MeT Department official said. "The intensity of the earthquake, which had its epicentre in Afghanistan-Tajikistan border, measured 6.2 on the Richter Scale," the official said.</p>
                    <p>There were no reports of loss of life or damage to property, government officials said.</p>
                    <p><mark>Source: Times of India</mark></p>
                </div>
            </div>
            <div class="col-md-8 graphic sticky">
                <div class="text-center">
                    <img id="globe" src="images/img2.gif" alt="Globe showing earthquake activity">
                </div>
            </div>
        </div>
    </div>

    <!-- Transition Section -->
    <div class="background-image bg2">
        <div>
            <h1>Thankfully no damages have been reported</h1>
            <h3>Monitoring continues across the region</h3>
        </div>
    </div>

    <!-- Second Scrollytelling Section -->
    <div class="container">
        <div class="row">
            <div class="col-md-8 graphic sticky">
                <div class="text-center">
                    <p><strong>Earthquake occurred in Hindu Kush region</strong></p>
                    <img src="images/EarthquakeLocation.png" id="mountains" alt="Earthquake location map">
                </div>
            </div>
            <div class="col-md-4">
                <div class="step" id="blocks-step-one">
                    <h3>Hindu Kush Region</h3>
                    <p>The tremors were felt in "most parts" of the earthquake-prone country, said Mohammad Omar Mohammadi, spokesman for the national disaster management ministry.</p>
                </div>
                <div class="step" id="blocks-step-two">
                    <h3>Regional Impact</h3>
                    <p>In neighbouring Pakistan's city of Peshawar near the Afghan border, people rushed into the streets following the tremor, fearing aftershocks, witnesses told AFP.</p>
                    <p>Earlier in the day, a magnitude 5.1 earthquake rattled parts of eastern Pakistan, near the border with Afghanistan. That quake caused a stampede at a school in the northwestern city of Bannu, injuring at least 10 students, according to a local police official.</p>
                    <p><mark>Source: Times of India</mark></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2024 Earthquake Report. Data sources: Times of India, Reuters, AFP</p>
        </div>
    </footer>

    <!-- Scripts - Load in correct order -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.12.2/intersection-observer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/scrollama@3.2.0/build/scrollama.min.js"></script>
    <script src="stickyfill.min.js"></script>

    <script>
        // Wait for all scripts to load
        window.addEventListener('load', function() {
            console.log('Page loaded, initializing scrollama...');
            
            // Check if required libraries are loaded
            if (typeof d3 === 'undefined') {
                console.error('D3 is not loaded');
                return;
            }
            
            if (typeof scrollama === 'undefined') {
                console.error('Scrollama is not loaded');
                return;
            }
            
            // Allow position: sticky to work in old browsers
            var elements = document.querySelectorAll('.sticky');
            if (typeof Stickyfill !== 'undefined') {
                Stickyfill.add(elements);
            }

            // Initialize scrollama with better settings
            var scroller = scrollama();

            scroller
                .setup({
                    offset: 0.5,
                    step: '.step',
                    debug: false,
                    threshold: 4
                })
                .onStepEnter(function(response) {
                    console.log('Step enter:', response.element.id);
                    d3.select(response.element).dispatch('stepin');
                    d3.select(response.element).classed('active', true);
                })
                .onStepExit(function(response) {
                    console.log('Step exit:', response.element.id);
                    d3.select(response.element).dispatch('stepout');
                    d3.select(response.element).classed('active', false);
                });

            // Handle window resize for smooth responsive behavior
            window.addEventListener('resize', function() {
                scroller.resize();
            });

            // Smooth scroll behavior
            document.documentElement.style.scrollBehavior = 'smooth';

            // Image swapping logic
            setupImageSwapping();
        });

        function setupImageSwapping() {
            console.log('Setting up image swapping...');
            
            // Preload images for smooth transitions
            const imageCache = {};
            const imagesToPreload = [
                'images/img1.png',
                'images/img2.gif',
                'images/Delhiupshot.jpg',
                'images/RajasthanUpshot.jpg',
                'images/EarthquakeLocation.png'
            ];
            
            imagesToPreload.forEach(src => {
                const img = new Image();
                img.src = src;
                imageCache[src] = img;
            });
            
            // Smooth image transition function
            function smoothImageTransition(selector, newSrc) {
                const img = d3.select(selector);
                img.style('opacity', 0)
                   .transition()
                   .duration(300)
                   .on('end', function() {
                       img.attr('src', newSrc)
                          .transition()
                          .duration(300)
                          .style('opacity', 1);
                   });
            }
            
            d3.select("#step-one")
                .on('stepin', function(){
                    console.log('Step one active - showing gif');
                    smoothImageTransition("#globe", "images/img2.gif");
                });

            d3.select("#step-two")
                .on('stepin', function(){
                    console.log('Step two active - showing static image');
                    smoothImageTransition("#globe", "images/img1.png");
                });

            d3.select("#blocks-step-one")
                .on('stepin', function(){
                    console.log('Blocks step one active - Delhi image');
                    smoothImageTransition("#mountains", "images/Delhiupshot.jpg");
                });

            d3.select("#blocks-step-two")
                .on('stepin', function(){
                    console.log('Blocks step two active - Rajasthan image');
                    smoothImageTransition("#mountains", "images/RajasthanUpshot.jpg");
                });
        }

        // Fallback error handling
        window.addEventListener('error', function(e) {
            console.error('Script error:', e.message, e.filename, e.lineno);
        });
    </script>
</body>
</html>
